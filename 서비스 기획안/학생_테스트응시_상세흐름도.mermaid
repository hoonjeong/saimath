graph TD
    Start[테스트 시작] --> Welcome[환영 화면<br/>사이수학 입학테스트]
    Welcome --> StartBtn[시작하기 버튼]
    StartBtn --> InfoForm[정보 입력 폼]
    
    InfoForm --> NameInput[이름 입력란]
    NameInput --> PhoneInput[전화번호 입력란<br/>010-0000-0000]
    PhoneInput --> GradeSelect[학년 선택<br/>드롭다운: 초1~초6]
    GradeSelect --> SemesterSelect[학기 선택<br/>라디오: 1학기/2학기]
    SemesterSelect --> SubmitInfo[시작하기 버튼]
    
    SubmitInfo --> Validate{입력값 검증}
    Validate -->|이름 미입력| ErrorName[이름을 입력해주세요]
    ErrorName --> NameInput
    Validate -->|전화번호 미입력| ErrorPhone[전화번호를<br/>입력해주세요]
    ErrorPhone --> PhoneInput
    Validate -->|학년 미선택| ErrorGrade[학년을 선택해주세요]
    ErrorGrade --> GradeSelect
    Validate -->|학기 미선택| ErrorSemester[학기를 선택해주세요]
    ErrorSemester --> SemesterSelect
    
    Validate -->|모두 입력됨| CheckTest{해당 시험지<br/>존재 확인}
    CheckTest -->|없음| NoTest[시험지가 없습니다<br/>관리자에게 문의하세요]
    NoTest --> InfoForm
    CheckTest -->|있음| LoadingTest[시험지 불러오는 중...]
    
    LoadingTest --> StartTest[테스트 시작<br/>문제 1/25]
    StartTest --> QuestionView[문제 화면]
    
    QuestionView --> Progress[진행 표시<br/>1/25, 2/25...]
    Progress --> QuestionImage{문제 이미지}
    QuestionImage -->|있음| ShowImage[이미지 표시]
    QuestionImage -->|없음| ShowText[텍스트만 표시]
    ShowImage --> Choices
    ShowText --> Choices[선지 4개 표시]
    
    Choices --> Choice1[①번 선지]
    Choices --> Choice2[②번 선지]
    Choices --> Choice3[③번 선지]
    Choices --> Choice4[④번 선지]
    
    Choice1 --> Selected{선지 선택}
    Choice2 --> Selected
    Choice3 --> Selected
    Choice4 --> Selected
    
    Selected --> Highlight[선택된 선지<br/>하이라이트 표시]
    Highlight --> NextBtn[다음 버튼 활성화]
    NextBtn --> ClickNext[다음 버튼 클릭]
    
    ClickNext --> SaveAnswer[(답안 임시 저장<br/>문제번호-선택답)]
    SaveAnswer --> QuestionCount{문제 번호}
    
    QuestionCount -->|1~24번| NextQuestion[다음 문제로 이동<br/>N+1/25]
    NextQuestion --> QuestionView
    
    QuestionCount -->|25번| LastConfirm{제출 확인 팝업<br/>제출하시겠습니까?}
    LastConfirm -->|취소| QuestionView
    LastConfirm -->|확인| Scoring[채점 중...]
    
    Scoring --> Calculate[정답 개수 계산<br/>각 문제 정답과 비교]
    Calculate --> ScoreCalc[점수 계산<br/>정답수 × 4점]
    ScoreCalc --> SaveResult[(결과 DB 저장<br/>- 학생 정보<br/>- 응시 일시<br/>- 각 문제 답안<br/>- 점수)]
    
    SaveResult --> ResultScreen[결과 화면]
    ResultScreen --> ShowScore[점수 표시<br/>XX점 / 100점]
    ShowScore --> ShowCorrect[정답 개수<br/>XX개 / 25개]
    ShowCorrect --> Message{점수 구간별<br/>메시지}
    Message -->|90점 이상| ExcellentMsg[훌륭합니다!]
    Message -->|70-89점| GoodMsg[잘했습니다!]
    Message -->|70점 미만| TryAgainMsg[다음에 다시<br/>도전해보세요!]
    
    ExcellentMsg --> EndOptions
    GoodMsg --> EndOptions
    TryAgainMsg --> EndOptions[종료 안내]
    EndOptions --> ThankYou[감사합니다<br/>결과는 관리자가<br/>확인할 수 있습니다]
    
    %% 중간 이탈 처리
    QuestionView -.->|브라우저 닫기| AutoSave[(자동 임시 저장<br/>현재까지 답안)]
    
    classDef inputColor fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef errorColor fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef processColor fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    classDef resultColor fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    
    class InfoForm,NameInput,PhoneInput,GradeSelect,SemesterSelect inputColor
    class ErrorName,ErrorPhone,ErrorGrade,ErrorSemester,NoTest errorColor
    class Scoring,Calculate,ScoreCalc processColor
    class ResultScreen,ShowScore,ShowCorrect,ExcellentMsg,GoodMsg resultColor
