graph TD
    Start[서비스 접속] --> UserType{사용자 유형}
    
    %% 관리자 흐름
    UserType -->|관리자| AdminHome[관리자 홈 화면]
    AdminHome --> AdminMenu{메뉴 선택}
    
    AdminMenu -->|시험지 만들기| CreateTest[시험지 생성 화면]
    CreateTest --> SelectGrade[학년/학기 선택]
    SelectGrade --> QuestionInput[문제 입력 화면]
    QuestionInput --> AddQuestion{문제 추가}
    AddQuestion -->|이미지 첨부| ImageUpload[이미지 업로드]
    AddQuestion -->|선지 입력| ChoiceInput[4개 선지 작성]
    AddQuestion -->|정답 설정| AnswerSet[정답 선택]
    ImageUpload --> QuestionCount{25문제 완성?}
    ChoiceInput --> QuestionCount
    AnswerSet --> QuestionCount
    QuestionCount -->|아니오| QuestionInput
    QuestionCount -->|예| SaveTest[시험지 저장]
    SaveTest --> DBSave[(로컬 DB 저장)]
    DBSave --> AdminHome
    
    AdminMenu -->|결과 보기| ResultHome[결과 조회 화면]
    ResultHome --> StudentList[학생 목록 표시]
    StudentList --> SelectStudent[학생 이름 선택]
    SelectStudent --> TestHistory[응시 이력 목록<br/>날짜별 정렬]
    TestHistory --> SelectTest[특정 테스트 선택]
    SelectTest --> DetailResult[상세 결과 화면<br/>문제별 정답/오답<br/>총점/평균]
    DetailResult --> TestHistory
    
    %% 학생 흐름
    UserType -->|학생| StudentStart[테스트 시작 화면]
    StudentStart --> InfoInput[정보 입력 화면]
    InfoInput --> InputName[이름 입력]
    InputName --> InputPhone[전화번호 입력]
    InputPhone --> SelectStudentGrade[학년 선택]
    SelectStudentGrade --> SelectSemester[학기 선택]
    SelectSemester --> ValidCheck{정보 확인}
    ValidCheck -->|미입력 항목 있음| InfoInput
    ValidCheck -->|모두 입력됨| LoadTest[해당 시험지 불러오기]
    LoadTest --> TestCheck{시험지 존재?}
    TestCheck -->|없음| ErrorNoTest[시험지 없음 안내]
    ErrorNoTest --> InfoInput
    TestCheck -->|있음| Question1[1번 문제 표시]
    
    Question1 --> ShowQuestion[문제 화면 구성<br/>- 문제 이미지<br/>- 4개 선지<br/>- 입력 버튼]
    ShowQuestion --> SelectChoice[선지 선택]
    SelectChoice --> ChoiceCheck{선지 선택됨?}
    ChoiceCheck -->|아니오| SelectChoice
    ChoiceCheck -->|예| ClickSubmit[입력 버튼 클릭]
    ClickSubmit --> SaveAnswer[답안 저장]
    SaveAnswer --> QuestionNum{문제 번호 확인}
    QuestionNum -->|1~24번| NextQuestion[다음 문제로 이동]
    NextQuestion --> ShowQuestion
    QuestionNum -->|25번| AutoScore[자동 채점]
    
    AutoScore --> CalcScore[점수 계산<br/>정답 개수 × 4점]
    CalcScore --> ShowResult[결과 화면 표시<br/>총점 / 100점<br/>정답 개수]
    ShowResult --> SaveResult[(결과 DB 저장<br/>- 학생 정보<br/>- 응시 일시<br/>- 답안<br/>- 점수)]
    SaveResult --> TestEnd[테스트 종료]
    
    %% 스타일링
    classDef adminColor fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef studentColor fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef dbColor fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef processColor fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    
    class AdminHome,AdminMenu,CreateTest,SelectGrade,QuestionInput,ResultHome,StudentList,SelectStudent,TestHistory,SelectTest,DetailResult adminColor
    class StudentStart,InfoInput,InputName,InputPhone,SelectStudentGrade,SelectSemester,Question1,ShowQuestion,SelectChoice,ShowResult studentColor
    class DBSave,SaveResult dbColor
    class AutoScore,CalcScore,SaveAnswer,LoadTest processColor
